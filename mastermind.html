<!DOCTYPE html>
<html lang="en">
	<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastermind Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f5;
            margin: 0;
            padding: 20px;
        }

        #game-container {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        /* Color Selection Panel */
        #button-board {
            background-color: rgb(210, 210, 220);
            padding: 20px;
            border: 1px solid black;
            width: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #undo-button {
            font-size: 80px;
            padding: 20px;
            margin-bottom: 0;
            background-color: rgb(210, 210, 220);
            border: 1px solid black;
            color: rgb(128, 128, 128);
            cursor: pointer;
        }

        #undo-button:disabled {
            background-color: #e0e0e0;
            color: #a0a0a0;
            cursor: not-allowed;
            border: 1px solid #a0a0a0;
        }

        #undo-button:not(:disabled) {
            background-color: #ffffff;
            color: #000000;
        }

        #color-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: repeat(3, 1fr);
            gap: 0;
            height: 400px;
            flex-shrink: 0;
        }

        .button-cell {
            background-color: rgb(210, 210, 220);
            border: 1px solid black;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: border 0.1s;
            cursor: pointer;
            aspect-ratio: 1;
        }

        .button-cell:hover {
            border: 5px solid rgb(51, 153, 255);
            padding: 16px; /* Reduced padding to maintain size when border grows */
        }

        .color-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid black;
            pointer-events: none;
        }

        .color-btn:hover {
            border: 2px solid black;
        }

        .color-btn.red::after { background-color: red; }
        .color-btn.blue::after { background-color: blue; }
        .color-btn.green::after { background-color: rgb(10, 210, 10); }
        .color-btn.yellow::after { background-color: yellow; }
        .color-btn.orange::after { background-color: orange; }
        .color-btn.magenta::after { background-color: magenta; }

        /* Game Board */
        #hole-board {
            background-color: rgb(210, 210, 220);
            padding: 20px;
            border: 1px solid black;
            display: flex;
            flex-direction: column;
        }

        .game-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
            height: 60px;
        }

        .hole {
            width: 50px;
            height: 50px;
            min-width: 50px;
            min-height: 50px;
            border-radius: 50%;
            border: 2px solid black;
            background-color: #d2d2dc;
        }

        #answer-row .hole {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .sequence-label {
            width: 120px;
            margin-left: 10px;
        }

        .mastermind-label {
            width: 120px;
            margin-left: 10px;
            text-align: center;
        }

        .check-button {
            padding: 5px 10px;
            margin-left: auto;
            cursor: pointer;
            width: 80px;
        }

        .check-button:disabled {
            cursor: not-allowed;
        }

        /* Feedback Pegs */
        .feedback {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin: 0 10px;
            padding: 5px;
            border: 1px solid black;
            width: 50px;
            height: 50px;
        }

        .peg {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid black;
            background-color: #d2d2dc;
        }

        /* Instructions Panel */
        #instruction-panel {
            background-color: #d2d2dc;
            padding: 20px;
            border: 1px solid black;
            width: 300px;
        }

        #scoreboard {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid black;
            background-color: rgb(210, 210, 220);
        }

        /* Add a container for mastermind label and feedback to keep them aligned */
        .feedback-column {
            width: 120px;
            display: flex;
            justify-content: center;
        }

        /* Add styles for reset button */
        .reset-button {
            font-size: 40px;
            padding: 10px;
            margin-top: 20px;
            width: 50%;
            align-self: center;
            background-color: rgb(210, 210, 220);
            border: 1px solid black;
            color: rgb(128, 128, 128);
            cursor: pointer;
        }

        .reset-button:hover {
            background-color: #ffffff;
            color: #000000;
        }
    </style>
	</head>
<body>
    <div id="game-container">
        <!-- Color Selection Panel -->
        <div id="button-board">
            <button id="undo-button" disabled>Undo</button>
            <div id="color-buttons">
                <div class="button-cell">
                    <button class="color-btn" style="background-color: red"></button>
                </div>
                <div class="button-cell">
                    <button class="color-btn" style="background-color: blue"></button>
                </div>
                <div class="button-cell">
                    <button class="color-btn" style="background-color: rgb(10, 210, 10)"></button>
                </div>
                <div class="button-cell">
                    <button class="color-btn" style="background-color: yellow"></button>
                </div>
                <div class="button-cell">
                    <button class="color-btn" style="background-color: orange"></button>
                </div>
                <div class="button-cell">
                    <button class="color-btn" style="background-color: magenta"></button>
                </div>
            </div>
            <button class="reset-button" onclick="initGame()">Reset Game</button>
        </div>

        <!-- Game Board -->
        <div id="hole-board">
            <!-- Answer Row -->
            <div class="game-row" id="answer-row">
                <div class="hole"></div>
                <div class="hole"></div>
                <div class="hole"></div>
                <div class="hole"></div>
                <div class="sequence-label">Correct Sequence</div>
                <div class="mastermind-label">Mastermind</div>
            </div>
        </div>

        <!-- Instructions Panel -->
        <div id="instruction-panel">
            <h3>Instructions:</h3>
            <p>This is the game mastermind. A sequence of colors
            is determined when the game starts. Colors can be repeated.
            You have to guess
            that sequence by clicking the colored circle buttons. Notice the undo
            button to be used if you make a mistake on a particular row.
            After you have guessed a row, ensure that you want to submit
            that row by clicking check. Once you have clicked check
            you can't undo that row. After check is clicked you will be
            informed of your results. A white peg means that one of your
            guesses was guessed correctly in the right location while a
            black peg means that one of your guesses was guessed correctly
            but in the wrong location. If a color is repeated in the answer,
            and a player selects that color, that color is only counted once
            by the pegs, or feedback from the computer.
            You have ten tries to guess the correct sequence.
            Credits: Developed by Amit Joshi. Github: @amitjoshi24</p>
            <div id="scoreboard">
                <div>Wins: 0/0 (0.00%)</div>
                <div>Current Streak: 0</div>
                <div>Longest Streak: 0</div>
            </div>
        </div>
    </div>

    <script>
        const colors = ['red', 'blue', 'rgb(10, 210, 10)', 'yellow', 'orange', 'magenta'];
        let secretCode = [];
        let currentGuess = [];
        let currentRow = 0;
        const maxRows = 10;
        let gameActive = true;
        let stats = {
            wins: 0,
            total: 0,
            currentStreak: 0,
            longestStreak: 0
        };

        function initGame() {
            // Generate secret code
            secretCode = Array.from({length: 4}, () => colors[Math.floor(Math.random() * colors.length)]);
            
            // Clear game board except answer row
            const holeBoard = document.getElementById('hole-board');
            while (holeBoard.children.length > 1) {
                holeBoard.removeChild(holeBoard.lastChild);
            }

            // Create game rows
            for (let i = 0; i < maxRows; i++) {
                createGameRow(i);
            }

            // Reset game state
            currentGuess = [];
            currentRow = 0;
            gameActive = true;
            document.getElementById('undo-button').disabled = true;
            enableColorButtons(true);
        }

        function createGameRow(rowIndex) {
            const row = document.createElement('div');
            row.className = 'game-row';
            
            // Create holes
            for (let i = 0; i < 4; i++) {
                const hole = document.createElement('div');
                hole.className = 'hole';
                row.appendChild(hole);
            }

            // Create check button
            const checkBtn = document.createElement('button');
            checkBtn.className = 'check-button';
            checkBtn.textContent = 'Check';
            checkBtn.disabled = true;
            checkBtn.onclick = () => {
                checkGuess(rowIndex);
                checkBtn.disabled = true;
            };
            row.appendChild(checkBtn);

            // Create feedback container
            const feedbackColumn = document.createElement('div');
            feedbackColumn.className = 'feedback-column';
            
            // Create feedback pegs
            const feedback = document.createElement('div');
            feedback.className = 'feedback';
            for (let i = 0; i < 4; i++) {
                const peg = document.createElement('div');
                peg.className = 'peg';
                feedback.appendChild(peg);
            }
            feedbackColumn.appendChild(feedback);
            row.appendChild(feedbackColumn);

            document.getElementById('hole-board').appendChild(row);
        }

        // Update color selection handlers
        document.querySelectorAll('.button-cell').forEach((cell, index) => {
            cell.onclick = () => {
                if (!gameActive) return;
                
                const currentRowElement = document.getElementsByClassName('game-row')[1 + (maxRows - 1 - currentRow)];
                const checkBtn = currentRowElement.querySelector('.check-button');
                
                if (currentGuess.length < 4) {
                    currentGuess.push(colors[index]);
                    currentRowElement.children[currentGuess.length - 1].style.backgroundColor = colors[index];
                    document.getElementById('undo-button').disabled = false;
                    
                    // Enable check button only if we have 4 colors
                    checkBtn.disabled = currentGuess.length !== 4;
                }
            };
        });

        // Update undo handler
        document.getElementById('undo-button').onclick = () => {
            if (currentGuess.length > 0) {
                const currentRowElement = document.getElementsByClassName('game-row')[1 + (maxRows - 1 - currentRow)];
                const checkBtn = currentRowElement.querySelector('.check-button');
                
                currentRowElement.children[currentGuess.length - 1].style.backgroundColor = '#d2d2dc';
                currentGuess.pop();
                
                // Disable check button since we now have fewer than 4 colors
                checkBtn.disabled = true;
                
                // Disable undo button if no colors left
                document.getElementById('undo-button').disabled = currentGuess.length === 0;
            }
        };

        function checkGuess(rowIndex) {
            if (currentGuess.length !== 4) return;

            const feedback = getFeedback();
            const currentRowElement = document.getElementsByClassName('game-row')[1 + (maxRows - 1 - currentRow)];
            const pegs = currentRowElement.querySelector('.feedback').children;
            
            let pegIndex = 0;
            feedback.white.forEach(() => {
                pegs[pegIndex++].style.backgroundColor = 'white';
            });
            feedback.black.forEach(() => {
                pegs[pegIndex++].style.backgroundColor = 'black';
            });

            if (feedback.white.length === 4) {
                gameWon();
            } else if (currentRow === maxRows - 1) {
                gameLost();
            } else {
                currentRow++;
                currentGuess = [];
                document.getElementById('undo-button').disabled = true;
            }
        }

        function getFeedback() {
            const feedback = { white: [], black: [] };
            const codeCopy = [...secretCode];
            const guessCopy = [...currentGuess];

            // Check for correct position and color (white pegs)
            for (let i = 0; i < 4; i++) {
                if (guessCopy[i] === codeCopy[i]) {
                    feedback.white.push(i);
                    codeCopy[i] = null;
                    guessCopy[i] = null;
                }
            }

            // Check for correct color but wrong position (black pegs)
            for (let i = 0; i < 4; i++) {
                if (guessCopy[i] === null) continue;
                const codeIndex = codeCopy.indexOf(guessCopy[i]);
                if (codeIndex !== -1) {
                    feedback.black.push(i);
                    codeCopy[codeIndex] = null;
                }
            }

            return feedback;
        }

        function gameWon() {
            gameActive = false;
            stats.wins++;
            stats.total++;
            stats.currentStreak++;
            stats.longestStreak = Math.max(stats.longestStreak, stats.currentStreak);
            updateScoreboard();
            revealAnswer();
            setTimeout(() => {
                alert('Congratulations! You won!');
            }, 100);
        }

        function gameLost() {
            gameActive = false;
            stats.total++;
            stats.currentStreak = 0;
            updateScoreboard();
            revealAnswer();
            setTimeout(() => {
                alert('Game Over! The correct sequence is shown above.');
            }, 100);
        }

        function revealAnswer() {
            const answerRow = document.getElementById('answer-row');
            secretCode.forEach((color, index) => {
                answerRow.children[index].style.backgroundColor = color;
                answerRow.children[index].textContent = '';
            });
        }

        function updateScoreboard() {
            const winPercentage = (stats.wins / stats.total * 100).toFixed(2);
            document.getElementById('scoreboard').innerHTML = `
                <div>Wins: ${stats.wins}/${stats.total} (${winPercentage}%)</div>
                <div>Current Streak: ${stats.currentStreak}</div>
                <div>Longest Streak: ${stats.longestStreak}</div>
            `;
        }

        function enableColorButtons(enabled) {
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.disabled = !enabled;
            });
        }

        // Initialize the game
        initGame();
    </script>
	</body>
</html>

